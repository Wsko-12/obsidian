Заголовок **`Cache-Control`** используется для задания инструкций кеширования как для запросов, так и для ответов.

Существуют два вида кеша:
#### Local
Кеш браузера, на устройстве пользвателя

#### Shared
Кеширующие прокси


### Response directives

#### `no-store`
Запрещает кэширование ресурса полностью. Ресурс не должен сохраняться ни в браузере, ни на промежуточных прокси-серверах. Используется для конфиденциальных данных.

### `public`
Указывает, что ресурс может быть закэширован как браузером, так и промежуточными прокси-серверами. Используется для ресурсов, которые не содержат приватных данных.

### `private`
Указывает, что ресурс может быть закэширован только браузером (клиентом), но не промежуточными прокси-серверами. Используется для приватных данных, например, персонализированных страниц.

####  `max-age=<seconds>`
Указывает максимальное время (в секундах), в течение которого ресурс может считаться актуальным. После истечения этого времени кэш должен проверить актуальность ресурса на сервере.

#### `s-maxage=<seconds>`
Аналогично `max-age`, но применяется только для промежуточных прокси-серверов. Игнорируется браузерами.

#### `no-cache`
Указывает, что кэшированная версия ресурса не может быть использована без предварительной проверки её актуальности на сервере. Каждый запрос должен проверять, изменился ли ресурс.
**Поведение**: Каждый раз, когда клиент запрашивает ресурс, кэш должен отправить запрос на сервер для проверки, изменился ли ресурс. Если ресурс не изменился (статус `304 Not Modified`), кэш может использовать свою копию. Если ресурс изменился, сервер отправит новую версию.

#### `must-revalidate`
Указывает, что кэш должен строго соблюдать сроки актуальности (TTL). Если срок истёк, кэш обязан проверить актуальность ресурса на сервере перед использованием.
 **Поведение**: Пока срок TTL не истёк, кэш может использовать свою копию без запроса на сервер. Однако, как только срок истёк, кэш **обязан** проверить актуальность ресурса на сервере. Если сервер недоступен, кэш не должен использовать устаревшую копию и должен вернуть ошибку (`504 Gateway Timeout`).

#### `proxy-revalidate`
Аналогично `must-revalidate`, но применяется только для промежуточных прокси-серверов.

#### `immutable` 
Указывает, что ресурс никогда не изменится, и браузер может использовать кэшированную версию без проверки актуальности. Полезно для статических ресурсов, таких как изображения или CSS.

### Директивы для управления поведением кэша:

#### `no-transform`
Запрещает промежуточным прокси-серверам изменять ресурс (например, сжимать изображения или изменять формат).

#### `stale-while-revalidate=<seconds>`
Разрешает использовать устаревшую версию ресурса, пока кэш в фоновом режиме проверяет его актуальность на сервере. Если ресурс устарел, то браузер обновит кеш для последующих запросов

#### `stale-if-error=<seconds>`
Разрешает использовать устаревшую версию ресурса, если сервер возвращает ошибку.


#### `must-understand`
Директива `must-understand`response указывает, что кэш должен сохранять ответ только в том случае, если он понимает требования к кэшированию на основе кода состояния.

`must-understand`следует сочетать с `no-store`для резервного поведения.

```
Cache-Control: must-understand, no-store
```

Если кэш не поддерживает `must-understand`, он будет проигнорирован. Если `no-store`также присутствует , ответ не сохраняется.

Если кэш поддерживает `must-understand`, он сохраняет ответ с учетом требований к кэшу на основе его кода состояния.


### Use cases

Например, мы установили ресурсу:
```
Cache-Control: private, max-age=3600
```
### Что будет делать браузер?

1. **В течение 1 часа (3600 секунд)**:
- Браузер будет использовать кэшированную версию ресурса **без обращения к серверу**.
- Это поведение **отличается** от `no-cache`, где каждый запрос требует проверки актуальности.
2. **После истечения 1 часа**:
- Браузер должен проверить актуальность ресурса на сервере.
- Если сервер недоступен, браузер **может** использовать устаревшую копию. Чтобы это изменить, следует добавить директиву `must-revalidate`


Так же можно добавить `Cache-Control` заголовки к **запросу**

### Request directives
#### `no-cache`
Директива `no-cache`запроса просит кэши проверить ответ на исходном сервере перед повторным использованием.

Браузеры обычно добавляют `no-cache` запросы, когда пользователи **принудительно перезагружают** страницу.

### `no-store`
Директива `no-store` запроса позволяет клиенту потребовать, чтобы кэши воздерживались от сохранения запроса и соответствующего ответа — даже если ответ исходного сервера может быть сохранен.

#### `max-age`
Директива `max-age=N`запроса указывает, что клиент разрешает сохраненный ответ, который генерируется на исходном сервере в течение _N_ секунд

Пример:
```
Cache-Control: max-age=10800
```
Eсли **response**  был сгенерирован более 3 часов назад, кэш не сможет повторно использовать этот ответ.

Многие браузеры используют эту директиву для **перезагрузки** , как описано ниже.
```
Cache-Control: max-age=0
```

`max-age=0`является обходным путем для `no-cache`, поскольку многие старые реализации кэша (HTTP/1.0) не поддерживают `no-cache`. В последнее время браузеры все еще используют `max-age=0`в «перезагрузке» — для обратной совместимости — и в качестве альтернативы используют `no-cache`для вызова «принудительной перезагрузки».

#### `max-stale`
Директива `max-stale=N`запроса указывает, что клиент допускает сохраненный ответ, который является устаревшим в течение _N_ секунд. Если значение _N_ не указано, клиент примет устаревший ответ любого возраста.

Пример:
```
Cache-Control: max-stale=3600
```
указывает на то, что браузер примет устаревший ответ из кэша, срок действия которого истек в течение последнего часа.

Клиенты могут использовать этот заголовок, когда исходный сервер не работает или работает слишком медленно, и могут принимать кэшированные ответы из кэшей, даже если они немного устарели.

#### `min-fresh`
Директива `max-fresh=N`запроса указывает, что клиент (браузер или прокси) хочет получить версию ресурса, которая будет оставаться свежей как минимум **N секунд**.

Пример:
```
Cache-Control: min-fresh=600
```
Браузер хочет запросить ресурс и чтобы он оставался свежим еще 10 минут. На кеширующей прокси закеширован ответ с заголовком `Cache-Control: max-age=3600` (1 час), но закеширован он был 55 минут назад. Следовательно, ответ будет оставаться актуальным только 5 минут, а мы запрашивали в 10. Поэтому кеш не сможет отдать эту версию

#### `only-if-cached`
Клиент указывает, что должен быть возвращен уже кэшированный ответ. Если в кэше есть сохраненный ответ, даже устаревший, он будет возвращен. Если кэшированный ответ недоступен, будет возвращен ответ 504 Gateway Timeout