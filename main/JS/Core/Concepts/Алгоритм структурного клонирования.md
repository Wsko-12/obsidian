

Алгоритм, который используется при передаче объектов в воркер и тд.

Его отличие от поверхностного копирования в том, что копируются свойства вложенных объектов.

Лучше, чем `JSON.parse(JSON.stringify(obj))
так как может клонировать циклические ссылки:


```
const obj = {
    a: {
        x: 1,
        y: 0
    },
    b: "test",
};
obj.self = obj;

```


```
JSON.stringify(obj) 

// Uncaught TypeError: Converting circular structure to JSON
```



```
const obj_1 = structuredClone(obj)

obj_1 === obj // false

obj_1.a === obj.a // false


obj_1.self === obj_1 // false
```

Прототипы будут отбрасываться:

```
Object.setPrototypeOf(obj, {isProto: true})

obj.isProto // true

Object.getPrototypeOf(obj) === Object.prototype // false

const obj_2 = structuredClone(obj)

Object.getPrototypeOf(obj_2) === Object.prototype // true

Object.getPrototypeOf({}) === Object.prototype // true

```


Позволяет клонировать встроенные объекты типа
- `Date` (сохраняется как есть)
- `RegExp` (клонируется с теми же флагами и паттерном)
- `Array`
- `Map`
- `Set`
- `Error`
 - `Blob`
 - `File`
и тд: (https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm)


```
const regObj = new RegExp(/test/)

const regObj_2 = structuredClone(regObj)

regObj_2 === regObj // false

regObj_2.test('test') // true

```


Transferable objects - это специальные типы объектов, которые могут быть переданы из одного контекста выполнения (например, основного потока) в другой (например, Web Worker) без копирования их содержимого. Объект после передачи становится недоступным в исходном контексте. (https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects)

мы создаем [`ArrayBuffer`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)и затем клонируем объект, членом которого он является, передавая буфер. Мы можем использовать буфер в клонированном объекте, но если мы попытаемся использовать исходный буфер, мы получим исключение.

```javascript
// Create an ArrayBuffer with a size in bytes
const buffer1 = new ArrayBuffer(16);

const object1 = {
  buffer: buffer1,
};

// Clone the object containing the buffer, and transfer it
const object2 = structuredClone(object1, { transfer: [buffer1] });

// Create an array from the cloned buffer
const int32View2 = new Int32Array(object2.buffer);
int32View2[0] = 42;
console.log(int32View2[0]);

// Creating an array from the original buffer throws a TypeError
const int32View1 = new Int32Array(object1.buffer);
```


Links:
https://developer.mozilla.org/ru/docs/Web/API/Web_Workers_API/Structured_clone_algorithm
https://www.dev-notes.ru/articles/deep-copying-using-structured-clone/
https://developer.mozilla.org/en-US/docs/Web/API/Window/structuredClone
